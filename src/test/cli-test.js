/**
 * CLI Test for PDF Export Plugin
 *
 * This script simulates a browser environment using JSDOM to test the PDF export
 * functionality from the command line. It uses the plugin's actual conversion logic.
 */
import { JSDOM } from 'jsdom';
import { Canvas, Image } from 'canvas';
import html2canvas from 'html2canvas';
import { jsPDF } from 'jspdf';
import { readFileSync, writeFileSync, existsSync, mkdirSync } from 'fs';
import { join } from 'path';
import { pdf } from 'pdf-to-img';
// Setup JSDOM with canvas support
function setupDOM() {
    const dom = new JSDOM('<!DOCTYPE html><html><body></body></html>', {
        pretendToBeVisual: true,
        resources: 'usable',
        url: 'http://localhost'
    });
    // Set up global variables that html2canvas expects
    global.window = dom.window;
    global.document = dom.window.document;
    global.navigator = dom.window.navigator;
    global.HTMLElement = dom.window.HTMLElement;
    global.HTMLCanvasElement = dom.window.HTMLCanvasElement;
    global.Image = Image;
    // Patch canvas creation for html2canvas
    const originalCreateElement = dom.window.document.createElement.bind(dom.window.document);
    dom.window.document.createElement = function (tagName) {
        if (tagName === 'canvas') {
            const canvas = new Canvas(800, 600);
            return canvas;
        }
        return originalCreateElement(tagName);
    };
    return dom;
}
const DEFAULT_SETTINGS = {
    exportFolder: 'PDF Exports',
    pageSize: 'a4',
    includeImages: true,
    imageMaxWidth: 1600,
    showTitle: true,
    pdfMargin: 10,
    canvasScale: 2,
    autoVerifyPDF: false
};
/**
 * Apply PDF-friendly styles to the container
 */
function applyPDFStyles(container) {
    const style = document.createElement('style');
    style.textContent = `
		.markdown-preview-view {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
			font-size: 12pt;
			line-height: 1.6;
			color: #000 !important;
			background: #fff !important;
		}
		.markdown-preview-view h1 {
			font-size: 24pt;
			margin-top: 24pt;
			margin-bottom: 12pt;
			font-weight: bold;
			color: #000 !important;
		}
		.markdown-preview-view h2 {
			font-size: 20pt;
			margin-top: 20pt;
			margin-bottom: 10pt;
			font-weight: bold;
			color: #000 !important;
		}
		.markdown-preview-view h3 {
			font-size: 16pt;
			margin-top: 16pt;
			margin-bottom: 8pt;
			font-weight: bold;
			color: #000 !important;
		}
		.markdown-preview-view p {
			margin-bottom: 10pt;
			color: #000 !important;
		}
		.markdown-preview-view img {
			max-width: 100%;
			height: auto;
			display: block;
			margin: 12pt auto;
		}
		.markdown-preview-view * {
			color: #000 !important;
		}
	`;
    container.appendChild(style);
}
/**
 * Create a simple HTML container with rendered markdown
 * Note: This is a simplified version. In the real plugin, Obsidian's MarkdownRenderer is used.
 */
function renderMarkdownToHTML(content, title, showTitle) {
    const containerEl = document.createElement('div');
    containerEl.className = 'markdown-preview-view';
    containerEl.style.width = '800px';
    containerEl.style.padding = '40px';
    containerEl.style.backgroundColor = '#ffffff';
    containerEl.style.color = '#000000';
    document.body.appendChild(containerEl);
    if (showTitle) {
        const titleEl = document.createElement('h1');
        titleEl.textContent = title;
        titleEl.style.marginBottom = '20px';
        titleEl.style.borderBottom = '2px solid #ddd';
        titleEl.style.paddingBottom = '10px';
        containerEl.appendChild(titleEl);
    }
    // Simple markdown to HTML conversion (basic implementation)
    const contentEl = document.createElement('div');
    contentEl.innerHTML = content
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/^(.+)$/gm, '<p>$1</p>')
        .replace(/<p><h/g, '<h')
        .replace(/<\/h([1-6])><\/p>/g, '</h$1>');
    containerEl.appendChild(contentEl);
    applyPDFStyles(containerEl);
    return containerEl;
}
/**
 * Create PDF from HTML container (matching plugin logic)
 */
async function createPDFFromHTML(containerEl, title, settings) {
    // Convert HTML to canvas using html2canvas
    const canvas = await html2canvas(containerEl, {
        scale: settings.canvasScale,
        useCORS: true,
        logging: false,
        backgroundColor: '#ffffff',
        width: containerEl.scrollWidth,
        height: containerEl.scrollHeight
    });
    // PDF dimensions
    const pdf = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: settings.pageSize
    });
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const margin = settings.pdfMargin;
    // Calculate scaling to fit width
    const imgWidth = pageWidth - (margin * 2);
    const imgHeight = (canvas.height * imgWidth) / canvas.width;
    // Convert canvas to image data
    const imgData = canvas.toDataURL('image/png');
    // Calculate content height per page (in mm)
    const pageContentHeight = pageHeight - (margin * 2);
    // If content fits on one page, just add it
    if (imgHeight <= pageContentHeight) {
        pdf.addImage(imgData, 'PNG', margin, margin, imgWidth, imgHeight);
    }
    else {
        // Multi-page: slice the image
        let heightLeft = imgHeight;
        let position = 0;
        // Add first page
        pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
        heightLeft -= pageContentHeight;
        // Add additional pages
        while (heightLeft > 0) {
            position -= pageContentHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
            heightLeft -= pageContentHeight;
        }
    }
    return pdf;
}
/**
 * Convert PDF to PNG images for verification
 */
async function verifyPDF(pdfBuffer, baseName, outputFolder) {
    const verificationFolder = join(outputFolder, 'verification');
    if (!existsSync(verificationFolder)) {
        mkdirSync(verificationFolder, { recursive: true });
    }
    const document = await pdf(Buffer.from(pdfBuffer), { scale: 2.0 });
    const imagePaths = [];
    let pageNumber = 0;
    for await (const image of document) {
        pageNumber++;
        const imagePath = join(verificationFolder, `${baseName}_page_${pageNumber}.png`);
        writeFileSync(imagePath, image);
        imagePaths.push(imagePath);
        console.log(`  ✓ Generated: ${imagePath}`);
    }
    return imagePaths;
}
/**
 * Main test function
 */
async function testPDFExport(markdownPath, outputFolder, settings = {}) {
    console.log('=== PDF Export CLI Test ===\n');
    // Setup DOM environment
    console.log('1. Setting up DOM environment...');
    setupDOM();
    console.log('   ✓ DOM ready\n');
    // Merge settings with defaults
    const finalSettings = { ...DEFAULT_SETTINGS, ...settings };
    // Read markdown file
    console.log('2. Reading markdown file...');
    if (!existsSync(markdownPath)) {
        throw new Error(`Markdown file not found: ${markdownPath}`);
    }
    const content = readFileSync(markdownPath, 'utf-8');
    const title = markdownPath.split('/').pop()?.replace('.md', '') || 'Untitled';
    console.log(`   ✓ Loaded: ${title}\n`);
    // Render markdown to HTML
    console.log('3. Rendering markdown to HTML...');
    const containerEl = renderMarkdownToHTML(content, title, finalSettings.showTitle);
    console.log('   ✓ HTML rendered\n');
    // Create PDF
    console.log('4. Generating PDF...');
    const pdfDoc = await createPDFFromHTML(containerEl, title, finalSettings);
    console.log('   ✓ PDF generated\n');
    // Save PDF
    console.log('5. Saving PDF...');
    if (!existsSync(outputFolder)) {
        mkdirSync(outputFolder, { recursive: true });
    }
    const pdfPath = join(outputFolder, `${title}.pdf`);
    const pdfBlob = pdfDoc.output('blob');
    const arrayBuffer = await pdfBlob.arrayBuffer();
    writeFileSync(pdfPath, Buffer.from(arrayBuffer));
    console.log(`   ✓ Saved: ${pdfPath}\n`);
    // Verify PDF (convert to images)
    console.log('6. Verifying PDF (converting to images)...');
    const imagePaths = await verifyPDF(arrayBuffer, title, outputFolder);
    console.log(`   ✓ Generated ${imagePaths.length} verification image(s)\n`);
    console.log('=== Test Complete ===');
    console.log(`\nPDF saved to: ${pdfPath}`);
    console.log(`Verification images: ${imagePaths.length}`);
    imagePaths.forEach(path => console.log(`  - ${path}`));
}
// CLI interface
if (require.main === module) {
    const args = process.argv.slice(2);
    if (args.length === 0) {
        console.error('Usage: ts-node src/test/cli-test.ts <markdown-file> [output-folder]');
        console.error('Example: ts-node src/test/cli-test.ts "/Users/jeroendezwart/2th Brain/My Note.md"');
        process.exit(1);
    }
    const markdownPath = args[0];
    const outputFolder = args[1] || '/Users/jeroendezwart/2th Brain/PDF Exports';
    testPDFExport(markdownPath, outputFolder)
        .then(() => process.exit(0))
        .catch(error => {
        console.error('\n❌ Test failed:', error.message);
        console.error(error.stack);
        process.exit(1);
    });
}
export { testPDFExport, DEFAULT_SETTINGS };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLXRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjbGktdGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUVILE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFDOUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDdkMsT0FBTyxXQUFXLE1BQU0sYUFBYSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFDOUIsT0FBTyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLElBQUksQ0FBQztBQUN4RSxPQUFPLEVBQUUsSUFBSSxFQUFXLE1BQU0sTUFBTSxDQUFDO0FBQ3JDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFakMsa0NBQWtDO0FBQ2xDLFNBQVMsUUFBUTtJQUNoQixNQUFNLEdBQUcsR0FBRyxJQUFJLEtBQUssQ0FBQywyQ0FBMkMsRUFBRTtRQUNsRSxpQkFBaUIsRUFBRSxJQUFJO1FBQ3ZCLFNBQVMsRUFBRSxRQUFRO1FBQ25CLEdBQUcsRUFBRSxrQkFBa0I7S0FDdkIsQ0FBQyxDQUFDO0lBRUgsbURBQW1EO0lBQ25ELE1BQU0sQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQWEsQ0FBQztJQUNsQyxNQUFNLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO0lBQ3RDLE1BQU0sQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDeEMsTUFBTSxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQztJQUM1QyxNQUFNLENBQUMsaUJBQWlCLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQztJQUN4RCxNQUFNLENBQUMsS0FBSyxHQUFH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O0FBQ3hELENBQUM7QUFFRCxnQkFBZ0I7QUFDaEIsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLE1BQU0sRUFBRSxDQUFDO0lBQzdCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRW5DLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUN2QixPQUFPLENBQUMsS0FBSyxDQUFDLHFFQUFxRSxDQUFDLENBQUM7UUFDckYsT0FBTyxDQUFDLEtBQUssQ0FBQyxtRkFBbUYsQ0FBQyxDQUFDO1FBQ25HLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakIsQ0FBQztJQUVELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksNENBQTRDLENBQUM7SUFFN0UsYUFBYSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUM7U0FDdkMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDM0IsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDakQsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0IsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxPQUFPLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENMSSBUZXN0IGZvciBQREYgRXhwb3J0IFBsdWdpblxuICpcbiAqIFRoaXMgc2NyaXB0IHNpbXVsYXRlcyBhIGJyb3dzZXIgZW52aXJvbm1lbnQgdXNpbmcgSlNET00gdG8gdGVzdCB0aGUgUERGIGV4cG9ydFxuICogZnVuY3Rpb25hbGl0eSBmcm9tIHRoZSBjb21tYW5kIGxpbmUuIEl0IHVzZXMgdGhlIHBsdWdpbidzIGFjdHVhbCBjb252ZXJzaW9uIGxvZ2ljLlxuICovXG5cbmltcG9ydCB7IEpTRE9NIH0gZnJvbSAnanNkb20nO1xuaW1wb3J0IHsgQ2FudmFzLCBJbWFnZSB9IGZyb20gJ2NhbnZhcyc7XG5pbXBvcnQgaHRtbDJjYW52YXMgZnJvbSAnaHRtbDJjYW52YXMnO1xuaW1wb3J0IHsganNQREYgfSBmcm9tICdqc3BkZic7XG5pbXBvcnQgeyByZWFkRmlsZVN5bmMsIHdyaXRlRmlsZVN5bmMsIGV4aXN0c1N5bmMsIG1rZGlyU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IGpvaW4sIGRpcm5hbWUgfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IHBkZiB9IGZyb20gJ3BkZi10by1pbWcnO1xuXG4vLyBTZXR1cCBKU0RPTSB3aXRoIGNhbnZhcyBzdXBwb3J0XG5mdW5jdGlvbiBzZXR1cERPTSgpIHtcblx0Y29uc3QgZG9tID0gbmV3IEpTRE9NKCc8IURPQ1RZUEUgaHRtbD48aHRtbD48Ym9keT48L2JvZHk+PC9odG1sPicsIHtcblx0XHRwcmV0ZW5kVG9CZVZpc3VhbDogdHJ1ZSxcblx0XHRyZXNvdXJjZXM6ICd1c2FibGUnLFxuXHRcdHVybDogJ2h0dHA6Ly9sb2NhbGhvc3QnXG5cdH0pO1xuXG5cdC8vIFNldCB1cCBnbG9iYWwgdmFyaWFibGVzIHRoYXQgaHRtbDJjYW52YXMgZXhwZWN0c1xuXHRnbG9iYWwud2luZG93ID0gZG9tLndpbmRvdyBhcyBhbnk7XG5cdGdsb2JhbC5kb2N1bWVudCA9IGRvbS53aW5kb3cuZG9jdW1lbnQ7XG5cdGdsb2JhbC5uYXZpZ2F0b3IgPSBkb20ud2luZG93Lm5hdmlnYXRvcjtcblx0Z2xvYmFsLkhUTUxFbGVtZW50ID0gZG9tLndpbmRvdy5IVE1MRWxlbWVudDtcblx0Z2xvYmFsLkhUTUxDYW52YXNFbGVtZW50ID0gZG9tLndpbmRvdy5IVE1MQ2FudmFzRWxlbWVudDtcblx0Z2xvYmFsLkltYWdlID0gSW1hZ2UgYXMgYW55O1xuXG5cdC8vIFBhdGNoIGNhbnZhcyBjcmVhdGlvbiBmb3IgaHRtbDJjYW52YXNcblx0Y29uc3Qgb3JpZ2luYWxDcmVhdGVFbGVtZW50ID0gZG9tLndpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50LmJpbmQoZG9tLndpbmRvdy5kb2N1bWVudCk7XG5cdGRvbS53aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uKHRhZ05hbWU6IHN0cmluZykge1xuXHRcdGlmICh0YWdOYW1lID09PSAnY2FudmFzJykge1xuXHRcdFx0Y29uc3QgY2FudmFzID0gbmV3IENhbnZhcyg4MDAsIDYwMCk7XG5cdFx0XHRyZXR1cm4gY2FudmFzIGFzIGFueTtcblx0XHR9XG5cdFx0cmV0dXJuIG9yaWdpbmFsQ3JlYXRlRWxlbWVudCh0YWdOYW1lKTtcblx0fSBhcyBhbnk7XG5cblx0cmV0dXJuIGRvbTtcbn1cblxuLy8gU2V0dGluZ3MgaW50ZXJmYWNlIG1hdGNoaW5nIHRoZSBwbHVnaW5cbmludGVyZmFjZSBQREZFeHBvcnRTZXR0aW5ncyB7XG5cdGV4cG9ydEZvbGRlcjogc3RyaW5nO1xuXHRwYWdlU2l6ZTogJ2E0JyB8ICdsZXR0ZXInO1xuXHRpbmNsdWRlSW1hZ2VzOiBib29sZWFuO1xuXHRpbWFnZU1heFdpZHRoOiBudW1iZXI7XG5cdHNob3dUaXRsZTogYm9vbGVhbjtcblx0cGRmTWFyZ2luOiBudW1iZXI7XG5cdGNhbnZhc1NjYWxlOiBudW1iZXI7XG5cdGF1dG9WZXJpZnlQREY6IGJvb2xlYW47XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IFBERkV4cG9ydFNldHRpbmdzID0ge1xuXHRleHBvcnRGb2xkZXI6ICdQREYgRXhwb3J0cycsXG5cdHBhZ2VTaXplOiAnYTQnLFxuXHRpbmNsdWRlSW1hZ2VzOiB0cnVlLFxuXHRpbWFnZU1heFdpZHRoOiAxNjAwLFxuXHRzaG93VGl0bGU6IHRydWUsXG5cdHBkZk1hcmdpbjogMTAsXG5cdGNhbnZhc1NjYWxlOiAyLFxuXHRhdXRvVmVyaWZ5UERGOiBmYWxzZVxufTtcblxuLyoqXG4gKiBBcHBseSBQREYtZnJpZW5kbHkgc3R5bGVzIHRvIHRoZSBjb250YWluZXJcbiAqL1xuZnVuY3Rpb24gYXBwbHlQREZTdHlsZXMoY29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuXHRjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG5cdHN0eWxlLnRleHRDb250ZW50ID0gYFxuXHRcdC5tYXJrZG93bi1wcmV2aWV3LXZpZXcge1xuXHRcdFx0Zm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgXCJTZWdvZSBVSVwiLCBSb2JvdG8sIHNhbnMtc2VyaWY7XG5cdFx0XHRmb250LXNpemU6IDEycHQ7XG5cdFx0XHRsaW5lLWhlaWdodDogMS42O1xuXHRcdFx0Y29sb3I6ICMwMDAgIWltcG9ydGFudDtcblx0XHRcdGJhY2tncm91bmQ6ICNmZmYgIWltcG9ydGFudDtcblx0XHR9XG5cdFx0Lm1hcmtkb3duLXByZXZpZXctdmlldyBoMSB7XG5cdFx0XHRmb250LXNpemU6IDI0cHQ7XG5cdFx0XHRtYXJnaW4tdG9wOiAyNHB0O1xuXHRcdFx0bWFyZ2luLWJvdHRvbTogMTJwdDtcblx0XHRcdGZvbnQtd2VpZ2h0OiBib2xkO1xuXHRcdFx0Y29sb3I6ICMwMDAgIWltcG9ydGFudDtcblx0XHR9XG5cdFx0Lm1hcmtkb3duLXByZXZpZXctdmlldyBoMiB7XG5cdFx0XHRmb250LXNpemU6IDIwcHQ7XG5cdFx0XHRtYXJnaW4tdG9wOiAyMHB0O1xuXHRcdFx0bWFyZ2luLWJvdHRvbTogMTBwdDtcblx0XHRcdGZvbnQtd2VpZ2h0OiBib2xkO1xuXHRcdFx0Y29sb3I6ICMwMDAgIWltcG9ydGFudDtcblx0XHR9XG5cdFx0Lm1hcmtkb3duLXByZXZpZXctdmlldyBoMyB7XG5cdFx0XHRmb250LXNpemU6IDE2cHQ7XG5cdFx0XHRtYXJnaW4tdG9wOiAxNnB0O1xuXHRcdFx0bWFyZ2luLWJvdHRvbTogOHB0O1xuXHRcdFx0Zm9udC13ZWlnaHQ6IGJvbGQ7XG5cdFx0XHRjb2xvcjogIzAwMCAhaW1wb3J0YW50O1xuXHRcdH1cblx0XHQubWFya2Rvd24tcHJldmlldy12aWV3IHAge1xuXHRcdFx0bWFyZ2luLWJvdHRvbTogMTBwdDtcblx0XHRcdGNvbG9yOiAjMDAwICFpbXBvcnRhbnQ7XG5cdFx0fVxuXHRcdC5tYXJrZG93bi1wcmV2aWV3LXZpZXcgaW1nIHtcblx0XHRcdG1heC13aWR0aDogMTAwJTtcblx0XHRcdGhlaWdodDogYXV0bztcblx0XHRcdGRpc3BsYXk6IGJsb2NrO1xuXHRcdFx0bWFyZ2luOiAxMnB0IGF1dG87XG5cdFx0fVxuXHRcdC5tYXJrZG93bi1wcmV2aWV3LXZpZXcgKiB7XG5cdFx0XHRjb2xvcjogIzAwMCAhaW1wb3J0YW50O1xuXHRcdH1cblx0YDtcblx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHN0eWxlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBzaW1wbGUgSFRNTCBjb250YWluZXIgd2l0aCByZW5kZXJlZCBtYXJrZG93blxuICogTm90ZTogVGhpcyBpcyBhIHNpbXBsaWZpZWQgdmVyc2lvbi4gSW4gdGhlIHJlYWwgcGx1Z2luLCBPYnNpZGlhbidzIE1hcmtkb3duUmVuZGVyZXIgaXMgdXNlZC5cbiAqL1xuZnVuY3Rpb24gcmVuZGVyTWFya2Rvd25Ub0hUTUwoY29udGVudDogc3RyaW5nLCB0aXRsZTogc3RyaW5nLCBzaG93VGl0bGU6IGJvb2xlYW4pOiBIVE1MRWxlbWVudCB7XG5cdGNvbnN0IGNvbnRhaW5lckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdGNvbnRhaW5lckVsLmNsYXNzTmFtZSA9ICdtYXJrZG93bi1wcmV2aWV3LXZpZXcnO1xuXHQoY29udGFpbmVyRWwgYXMgYW55KS5zdHlsZS53aWR0aCA9ICc4MDBweCc7XG5cdChjb250YWluZXJFbCBhcyBhbnkpLnN0eWxlLnBhZGRpbmcgPSAnNDBweCc7XG5cdChjb250YWluZXJFbCBhcyBhbnkpLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZmZmZmZmJztcblx0KGNvbnRhaW5lckVsIGFzIGFueSkuc3R5bGUuY29sb3IgPSAnIzAwMDAwMCc7XG5cblx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXJFbCk7XG5cblx0aWYgKHNob3dUaXRsZSkge1xuXHRcdGNvbnN0IHRpdGxlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpO1xuXHRcdHRpdGxlRWwudGV4dENvbnRlbnQgPSB0aXRsZTtcblx0XHQodGl0bGVFbCBhcyBhbnkpLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcyMHB4Jztcblx0XHQodGl0bGVFbCBhcyBhbnkpLnN0eWxlLmJvcmRlckJvdHRvbSA9ICcycHggc29saWQgI2RkZCc7XG5cdFx0KHRpdGxlRWwgYXMgYW55KS5zdHlsZS5wYWRkaW5nQm90dG9tID0gJzEwcHgnO1xuXHRcdGNvbnRhaW5lckVsLmFwcGVuZENoaWxkKHRpdGxlRWwpO1xuXHR9XG5cblx0Ly8gU2ltcGxlIG1hcmtkb3duIHRvIEhUTUwgY29udmVyc2lvbiAoYmFzaWMgaW1wbGVtZW50YXRpb24pXG5cdGNvbnN0IGNvbnRlbnRFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRjb250ZW50RWwuaW5uZXJIVE1MID0gY29udGVudFxuXHRcdC5yZXBsYWNlKC9eIyAoLiokKS9naW0sICc8aDE+JDE8L2gxPicpXG5cdFx0LnJlcGxhY2UoL14jIyAoLiokKS9naW0sICc8aDI+JDE8L2gyPicpXG5cdFx0LnJlcGxhY2UoL14jIyMgKC4qJCkvZ2ltLCAnPGgzPiQxPC9oMz4nKVxuXHRcdC5yZXBsYWNlKC9cXCpcXCooLio/KVxcKlxcKi9nLCAnPHN0cm9uZz4kMTwvc3Ryb25nPicpXG5cdFx0LnJlcGxhY2UoL1xcKiguKj8pXFwqL2csICc8ZW0+JDE8L2VtPicpXG5cdFx0LnJlcGxhY2UoL1xcblxcbi9nLCAnPC9wPjxwPicpXG5cdFx0LnJlcGxhY2UoL14oLispJC9nbSwgJzxwPiQxPC9wPicpXG5cdFx0LnJlcGxhY2UoLzxwPjxoL2csICc8aCcpXG5cdFx0LnJlcGxhY2UoLzxcXC9oKFsxLTZdKT48XFwvcD4vZywgJzwvaCQxPicpO1xuXG5cdGNvbnRhaW5lckVsLmFwcGVuZENoaWxkKGNvbnRlbnRFbCk7XG5cdGFwcGx5UERGU3R5bGVzKGNvbnRhaW5lckVsKTtcblxuXHRyZXR1cm4gY29udGFpbmVyRWw7XG59XG5cbi8qKlxuICogQ3JlYXRlIFBERiBmcm9tIEhUTUwgY29udGFpbmVyIChtYXRjaGluZyBwbHVnaW4gbG9naWMpXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVBERkZyb21IVE1MKFxuXHRjb250YWluZXJFbDogSFRNTEVsZW1lbnQsXG5cdHRpdGxlOiBzdHJpbmcsXG5cdHNldHRpbmdzOiBQREZFeHBvcnRTZXR0aW5nc1xuKTogUHJvbWlzZTxqc1BERj4ge1xuXHQvLyBDb252ZXJ0IEhUTUwgdG8gY2FudmFzIHVzaW5nIGh0bWwyY2FudmFzXG5cdGNvbnN0IGNhbnZhcyA9IGF3YWl0IGh0bWwyY2FudmFzKGNvbnRhaW5lckVsLCB7XG5cdFx0c2NhbGU6IHNldHRpbmdzLmNhbnZhc1NjYWxlLFxuXHRcdHVzZUNPUlM6IHRydWUsXG5cdFx0bG9nZ2luZzogZmFsc2UsXG5cdFx0YmFja2dyb3VuZENvbG9yOiAnI2ZmZmZmZicsXG5cdFx0d2lkdGg6IChjb250YWluZXJFbCBhcyBhbnkpLnNjcm9sbFdpZHRoLFxuXHRcdGhlaWdodDogKGNvbnRhaW5lckVsIGFzIGFueSkuc2Nyb2xsSGVpZ2h0XG5cdH0pO1xuXG5cdC8vIFBERiBkaW1lbnNpb25zXG5cdGNvbnN0IHBkZiA9IG5ldyBqc1BERih7XG5cdFx0b3JpZW50YXRpb246ICdwb3J0cmFpdCcsXG5cdFx0dW5pdDogJ21tJyxcblx0XHRmb3JtYXQ6IHNldHRpbmdzLnBhZ2VTaXplXG5cdH0pO1xuXG5cdGNvbnN0IHBhZ2VXaWR0aCA9IHBkZi5pbnRlcm5hbC5wYWdlU2l6ZS5nZXRXaWR0aCgpO1xuXHRjb25zdCBwYWdlSGVpZ2h0ID0gcGRmLmludGVybmFsLnBhZ2VTaXplLmdldEhlaWdodCgpO1xuXHRjb25zdCBtYXJnaW4gPSBzZXR0aW5ncy5wZGZNYXJnaW47XG5cblx0Ly8gQ2FsY3VsYXRlIHNjYWxpbmcgdG8gZml0IHdpZHRoXG5cdGNvbnN0IGltZ1dpZHRoID0gcGFnZVdpZHRoIC0gKG1hcmdpbiAqIDIpO1xuXHRjb25zdCBpbWdIZWlnaHQgPSAoKGNhbnZhcyBhcyBhbnkpLmhlaWdodCAqIGltZ1dpZHRoKSAvIChjYW52YXMgYXMgYW55KS53aWR0aDtcblxuXHQvLyBDb252ZXJ0IGNhbnZhcyB0byBpbWFnZSBkYXRhXG5cdGNvbnN0IGltZ0RhdGEgPSAoY2FudmFzIGFzIGFueSkudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTtcblxuXHQvLyBDYWxjdWxhdGUgY29udGVudCBoZWlnaHQgcGVyIHBhZ2UgKGluIG1tKVxuXHRjb25zdCBwYWdlQ29udGVudEhlaWdodCA9IHBhZ2VIZWlnaHQgLSAobWFyZ2luICogMik7XG5cblx0Ly8gSWYgY29udGVudCBmaXRzIG9uIG9uZSBwYWdlLCBqdXN0IGFkZCBpdFxuXHRpZiAoaW1nSGVpZ2h0IDw9IHBhZ2VDb250ZW50SGVpZ2h0KSB7XG5cdFx0cGRmLmFkZEltYWdlKFxuXHRcdFx0aW1nRGF0YSxcblx0XHRcdCdQTkcnLFxuXHRcdFx0bWFyZ2luLFxuXHRcdFx0bWFyZ2luLFxuXHRcdFx0aW1nV2lkdGgsXG5cdFx0XHRpbWdIZWlnaHRcblx0XHQpO1xuXHR9IGVsc2Uge1xuXHRcdC8vIE11bHRpLXBhZ2U6IHNsaWNlIHRoZSBpbWFnZVxuXHRcdGxldCBoZWlnaHRMZWZ0ID0gaW1nSGVpZ2h0O1xuXHRcdGxldCBwb3NpdGlvbiA9IDA7XG5cblx0XHQvLyBBZGQgZmlyc3QgcGFnZVxuXHRcdHBkZi5hZGRJbWFnZShcblx0XHRcdGltZ0RhdGEsXG5cdFx0XHQnUE5HJyxcblx0XHRcdG1hcmdpbixcblx0XHRcdHBvc2l0aW9uLFxuXHRcdFx0aW1nV2lkdGgsXG5cdFx0XHRpbWdIZWlnaHRcblx0XHQpO1xuXHRcdGhlaWdodExlZnQgLT0gcGFnZUNvbnRlbnRIZWlnaHQ7XG5cblx0XHQvLyBBZGQgYWRkaXRpb25hbCBwYWdlc1xuXHRcdHdoaWxlIChoZWlnaHRMZWZ0ID4gMCkge1xuXHRcdFx0cG9zaXRpb24gLT0gcGFnZUNvbnRlbnRIZWlnaHQ7XG5cdFx0XHRwZGYuYWRkUGFnZSgpO1xuXHRcdFx0cGRmLmFkZEltYWdlKFxuXHRcdFx0XHRpbWdEYXRhLFxuXHRcdFx0XHQnUE5HJyxcblx0XHRcdFx0bWFyZ2luLFxuXHRcdFx0XHRwb3NpdGlvbixcblx0XHRcdFx0aW1nV2lkdGgsXG5cdFx0XHRcdGltZ0hlaWdodFxuXHRcdFx0KTtcblx0XHRcdGhlaWdodExlZnQgLT0gcGFnZUNvbnRlbnRIZWlnaHQ7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHBkZjtcbn1cblxuLyoqXG4gKiBDb252ZXJ0IFBERiB0byBQTkcgaW1hZ2VzIGZvciB2ZXJpZmljYXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UERGKHBkZkJ1ZmZlcjogQXJyYXlCdWZmZXIsIGJhc2VOYW1lOiBzdHJpbmcsIG91dHB1dEZvbGRlcjogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuXHRjb25zdCB2ZXJpZmljYXRpb25Gb2xkZXIgPSBqb2luKG91dHB1dEZvbGRlciwgJ3ZlcmlmaWNhdGlvbicpO1xuXHRpZiAoIWV4aXN0c1N5bmModmVyaWZpY2F0aW9uRm9sZGVyKSkge1xuXHRcdG1rZGlyU3luYyh2ZXJpZmljYXRpb25Gb2xkZXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuXHR9XG5cblx0Y29uc3QgZG9jdW1lbnQgPSBhd2FpdCBwZGYoQnVmZmVyLmZyb20ocGRmQnVmZmVyKSwgeyBzY2FsZTogMi4wIH0pO1xuXHRjb25zdCBpbWFnZVBhdGhzOiBzdHJpbmdbXSA9IFtdO1xuXHRsZXQgcGFnZU51bWJlciA9IDA7XG5cblx0Zm9yIGF3YWl0IChjb25zdCBpbWFnZSBvZiBkb2N1bWVudCkge1xuXHRcdHBhZ2VOdW1iZXIrKztcblx0XHRjb25zdCBpbWFnZVBhdGggPSBqb2luKHZlcmlmaWNhdGlvbkZvbGRlciwgYCR7YmFzZU5hbWV9X3BhZ2VfJHtwYWdlTnVtYmVyfS5wbmdgKTtcblx0XHR3cml0ZUZpbGVTeW5jKGltYWdlUGF0aCwgaW1hZ2UpO1xuXHRcdGltYWdlUGF0aHMucHVzaChpbWFnZVBhdGgpO1xuXHRcdGNvbnNvbGUubG9nKGAgIOKckyBHZW5lcmF0ZWQ6ICR7aW1hZ2VQYXRofWApO1xuXHR9XG5cblx0cmV0dXJuIGltYWdlUGF0aHM7XG59XG5cbi8qKlxuICogTWFpbiB0ZXN0IGZ1bmN0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHRlc3RQREZFeHBvcnQoXG5cdG1hcmtkb3duUGF0aDogc3RyaW5nLFxuXHRvdXRwdXRGb2xkZXI6IHN0cmluZyxcblx0c2V0dGluZ3M6IFBhcnRpYWw8UERGRXhwb3J0U2V0dGluZ3M+ID0ge31cbikge1xuXHRjb25zb2xlLmxvZygnPT09IFBERiBFeHBvcnQgQ0xJIFRlc3QgPT09XFxuJyk7XG5cblx0Ly8gU2V0dXAgRE9NIGVudmlyb25tZW50XG5cdGNvbnNvbGUubG9nKCcxLiBTZXR0aW5nIHVwIERPTSBlbnZpcm9ubWVudC4uLicpO1xuXHRzZXR1cERPTSgpO1xuXHRjb25zb2xlLmxvZygnICAg4pyTIERPTSByZWFkeVxcbicpO1xuXG5cdC8vIE1lcmdlIHNldHRpbmdzIHdpdGggZGVmYXVsdHNcblx0Y29uc3QgZmluYWxTZXR0aW5nczogUERGRXhwb3J0U2V0dGluZ3MgPSB7IC4uLkRFRkFVTFRfU0VUVElOR1MsIC4uLnNldHRpbmdzIH07XG5cblx0Ly8gUmVhZCBtYXJrZG93biBmaWxlXG5cdGNvbnNvbGUubG9nKCcyLiBSZWFkaW5nIG1hcmtkb3duIGZpbGUuLi4nKTtcblx0aWYgKCFleGlzdHNTeW5jKG1hcmtkb3duUGF0aCkpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYE1hcmtkb3duIGZpbGUgbm90IGZvdW5kOiAke21hcmtkb3duUGF0aH1gKTtcblx0fVxuXHRjb25zdCBjb250ZW50ID0gcmVhZEZpbGVTeW5jKG1hcmtkb3duUGF0aCwgJ3V0Zi04Jyk7XG5cdGNvbnN0IHRpdGxlID0gbWFya2Rvd25QYXRoLnNwbGl0KCcvJykucG9wKCk/LnJlcGxhY2UoJy5tZCcsICcnKSB8fCAnVW50aXRsZWQnO1xuXHRjb25zb2xlLmxvZyhgICAg4pyTIExvYWRlZDogJHt0aXRsZX1cXG5gKTtcblxuXHQvLyBSZW5kZXIgbWFya2Rvd24gdG8gSFRNTFxuXHRjb25zb2xlLmxvZygnMy4gUmVuZGVyaW5nIG1hcmtkb3duIHRvIEhUTUwuLi4nKTtcblx0Y29uc3QgY29udGFpbmVyRWwgPSByZW5kZXJNYXJrZG93blRvSFRNTChjb250ZW50LCB0aXRsZSwgZmluYWxTZXR0aW5ncy5zaG93VGl0bGUpO1xuXHRjb25zb2xlLmxvZygnICAg4pyTIEhUTUwgcmVuZGVyZWRcXG4nKTtcblxuXHQvLyBDcmVhdGUgUERGXG5cdGNvbnNvbGUubG9nKCc0LiBHZW5lcmF0aW5nIFBERi4uLicpO1xuXHRjb25zdCBwZGZEb2MgPSBhd2FpdCBjcmVhdGVQREZGcm9tSFRNTChjb250YWluZXJFbCwgdGl0bGUsIGZpbmFsU2V0dGluZ3MpO1xuXHRjb25zb2xlLmxvZygnICAg4pyTIFBERiBnZW5lcmF0ZWRcXG4nKTtcblxuXHQvLyBTYXZlIFBERlxuXHRjb25zb2xlLmxvZygnNS4gU2F2aW5nIFBERi4uLicpO1xuXHRpZiAoIWV4aXN0c1N5bmMob3V0cHV0Rm9sZGVyKSkge1xuXHRcdG1rZGlyU3luYyhvdXRwdXRGb2xkZXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuXHR9XG5cdGNvbnN0IHBkZlBhdGggPSBqb2luKG91dHB1dEZvbGRlciwgYCR7dGl0bGV9LnBkZmApO1xuXHRjb25zdCBwZGZCbG9iID0gcGRmRG9jLm91dHB1dCgnYmxvYicpIGFzIGFueTtcblx0Y29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBwZGZCbG9iLmFycmF5QnVmZmVyKCk7XG5cdHdyaXRlRmlsZVN5bmMocGRmUGF0aCwgQnVmZmVyLmZyb20oYXJyYXlCdWZmZXIpKTtcblx0Y29uc29sZS5sb2coYCAgIOKckyBTYXZlZDogJHtwZGZQYXRofVxcbmApO1xuXG5cdC8vIFZlcmlmeSBQREYgKGNvbnZlcnQgdG8gaW1hZ2VzKVxuXHRjb25zb2xlLmxvZygnNi4gVmVyaWZ5aW5nIFBERiAoY29udmVydGluZyB0byBpbWFnZXMpLi4uJyk7XG5cdGNvbnN0IGltYWdlUGF0aHMgPSBhd2FpdCB2ZXJpZnlQREYoYXJyYXlCdWZmZXIsIHRpdGxlLCBvdXRwdXRGb2xkZXIpO1xuXHRjb25zb2xlLmxvZyhgICAg4pyTIEdlbmVyYXRlZCAke2ltYWdlUGF0aHMubGVuZ3RofSB2ZXJpZmljYXRpb24gaW1hZ2UocylcXG5gKTtcblxuXHRjb25zb2xlLmxvZygnPT09IFRlc3QgQ29tcGxldGUgPT09Jyk7XG5cdGNvbnNvbGUubG9nKGBcXG5QREYgc2F2ZWQgdG86ICR7cGRmUGF0aH1gKTtcblx0Y29uc29sZS5sb2coYFZlcmlmaWNhdGlvbiBpbWFnZXM6ICR7aW1hZ2VQYXRocy5sZW5ndGh9YCk7XG5cdGltYWdlUGF0aHMuZm9yRWFjaChwYXRoID0+IGNvbnNvbGUubG9nKGAgIC0gJHtwYXRofWApKTtcbn1cblxuLy8gQ0xJIGludGVyZmFjZVxuaWYgKHJlcXVpcmUubWFpbiA9PT0gbW9kdWxlKSB7XG5cdGNvbnN0IGFyZ3MgPSBwcm9jZXNzLmFyZ3Yuc2xpY2UoMik7XG5cblx0aWYgKGFyZ3MubGVuZ3RoID09PSAwKSB7XG5cdFx0Y29uc29sZS5lcnJvcignVXNhZ2U6IHRzLW5vZGUgc3JjL3Rlc3QvY2xpLXRlc3QudHMgPG1hcmtkb3duLWZpbGU+IFtvdXRwdXQtZm9sZGVyXScpO1xuXHRcdGNvbnNvbGUuZXJyb3IoJ0V4YW1wbGU6IHRzLW5vZGUgc3JjL3Rlc3QvY2xpLXRlc3QudHMgXCIvVXNlcnMvamVyb2VuZGV6d2FydC8ydGggQnJhaW4vTXkgTm90ZS5tZFwiJyk7XG5cdFx0cHJvY2Vzcy5leGl0KDEpO1xuXHR9XG5cblx0Y29uc3QgbWFya2Rvd25QYXRoID0gYXJnc1swXTtcblx0Y29uc3Qgb3V0cHV0Rm9sZGVyID0gYXJnc1sxXSB8fCAnL1VzZXJzL2plcm9lbmRlendhcnQvMnRoIEJyYWluL1BERiBFeHBvcnRzJztcblxuXHR0ZXN0UERGRXhwb3J0KG1hcmtkb3duUGF0aCwgb3V0cHV0Rm9sZGVyKVxuXHRcdC50aGVuKCgpID0+IHByb2Nlc3MuZXhpdCgwKSlcblx0XHQuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0Y29uc29sZS5lcnJvcignXFxu4p2MIFRlc3QgZmFpbGVkOicsIGVycm9yLm1lc3NhZ2UpO1xuXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvci5zdGFjayk7XG5cdFx0XHRwcm9jZXNzLmV4aXQoMSk7XG5cdFx0fSk7XG59XG5cbmV4cG9ydCB7IHRlc3RQREZFeHBvcnQsIERFRkFVTFRfU0VUVElOR1MgfTtcbiJdfQ==